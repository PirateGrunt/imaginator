---
title: "Simulate Claims"
author: "Brian A. Fannin"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r echo=FALSE, message=FALSE}
library(dplyr)
```

Claim simulation occurs once we have a data frame of policies. For each row in this data frame, we will simulate zero or more claims and zero or more claim transactions. 

```{r}
library(imaginator)
set.seed(1234)
dfPolicy <- NewPolicies(500, 2001)
```

Claim simulation fits into two basic categories: 1) link ratio and 2) wait-time.

## Simulate by link ratio

This is basically chain ladder applied to individual claims.

```{r}
lstFreq <- list(
    PoissonHelper(10)
  , PoissonHelper(5)
  , PoissonHelper(2)
  , PoissonHelper(0.5)
)

lstSev <- list(
  LognormalHelper(meanlog = log(10000), sdlog = .5*log(10000))
)
lstSev[1:4] <- lstSev[1]

dfClaims <- ClaimsByFirstReport(dfPolicy
                                , Frequency = lstFreq
                                , Severity = lstSev
                                , Lags = 1:4)
```

We'll create a very simple example with three lag dates, fixed frequency and fixed link ratios.

```{r}
fixedLinks <- list(FixedVal(2)
                   , FixedVal(1.5))
```

```{r }
dfClaimsFixed <- ClaimsByLinkRatio(dfClaims
                                   , Links = fixedLinks
                                   , Lags = 1:3)
```

```{r echo=FALSE, message=FALSE}
dfDisplay <- dfClaimsFixed %>% 
  arrange(PolicyID) %>% 
  head()

knitr::kable(dfDisplay)
```

We can make things a bit more complicated by introducing variable link ratios

```{r }
normalLinks <- list(NormalHelper(2, 1, .7, 4)
                    , NormalHelper(1.5, .5, .7, 3))

dfVariableLinks <- ClaimsByLinkRatio(dfClaims
                                     , Links = normalLinks
                                     , Lags = 1:3)
```

```{r echo=FALSE, message=FALSE}
dfDisplay <- dfVariableLinks %>% 
  arrange(PolicyID) %>% 
  head()

knitr::kable(dfDisplay)
```

And for lots of fun, let's use a Poisson frequency, gamma severity and variable links.

```{r }
set.seed(1234)
dfAllVariable <- ClaimsByLinkRatio(dfClaims
                                   , Links = normalLinks
                                   , Lags = 1:3)
```

```{r echo=FALSE, message=FALSE}
dfDisplay <- dfAllVariable %>% 
  arrange(PolicyID) %>% 
  head(10)

knitr::kable(dfDisplay)
```

## Mojo

```{r}
library(imaginator)
dfPolicy <- NewPolicies(500, 2010)
```

```{r}
mySeverity <- GammaHelper(10000, 0.5)
```
